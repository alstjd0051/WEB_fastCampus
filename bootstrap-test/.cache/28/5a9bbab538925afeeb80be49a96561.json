{"id":"node_modules/mux-demux/index.js","dependencies":[{"name":"C:\\dev\\Workspaces\\WEB_fastCampus\\bootstrap-test\\package.json","includedInParent":true,"mtime":1624817355327},{"name":"C:\\dev\\Workspaces\\WEB_fastCampus\\bootstrap-test\\node_modules\\mux-demux\\package.json","includedInParent":true,"mtime":1624817354930},{"name":"event-stream","loc":{"line":1,"column":17},"parent":"C:\\dev\\Workspaces\\WEB_fastCampus\\bootstrap-test\\node_modules\\mux-demux\\index.js","resolved":"C:\\dev\\Workspaces\\WEB_fastCampus\\bootstrap-test\\node_modules\\event-stream\\index.js"},{"name":"xtend","loc":{"line":2,"column":21},"parent":"C:\\dev\\Workspaces\\WEB_fastCampus\\bootstrap-test\\node_modules\\mux-demux\\index.js","resolved":"C:\\dev\\Workspaces\\WEB_fastCampus\\bootstrap-test\\node_modules\\mux-demux\\node_modules\\xtend\\index.js"}],"generated":{"js":"var es = require('event-stream')\r\n  , extend = require('xtend')\r\n\r\nfunction MuxDemux (opts) {\r\n  if('function' === typeof opts)\r\n    opts = {wrapper: opts}\r\n\r\n  function createID() {\r\n    return (\r\n      Math.random().toString(16).slice(2) +\r\n      Math.random().toString(16).slice(2)\r\n    )\r\n  }\r\n\r\n  var streams = {}, streamCount = 0\r\n  var md = es.through(function (data) {\r\n    var id = data.shift()\r\n    var event = data[0]\r\n    var s = streams[id]\r\n    if(!s) {\r\n      if(event == 'close')\r\n        return\r\n      if(event != 'new') \r\n        return outer.emit('unknown', id)\r\n      md.emit('connection', createStream(id, data[1].meta, data[1].opts))\r\n    } \r\n    else if (event === 'pause')\r\n      s.paused = true\r\n    else if (event === 'resume') {\r\n      var p = s.paused\r\n      s.paused = false\r\n      if(p) s.emit('drain')\r\n    }\r\n    else if (event === 'error') {\r\n      var error = data[1]\r\n      if (typeof error === 'string') {\r\n        s.emit('error', new Error(error))\r\n      } else if (typeof error.message === 'string') {\r\n        var e = new Error(error.message)\r\n        extend(e, error)\r\n        s.emit('error', e)\r\n      } else {\r\n        s.emit('error', error)\r\n      }\r\n    }\r\n    else {\r\n      s.emit.apply(s, data)\r\n    }\r\n  })\r\n\r\n  function destroyAll (_err) {\r\n    md.removeListener('end', destroyAll)\r\n    md.removeListener('error', destroyAll)\r\n    md.removeListener('close', destroyAll)\r\n    var err = _err || new Error ('unexpected disconnection')\r\n    for (var i in streams) {\r\n      var s = streams[i]\r\n      s.destroyed = true\r\n      if (opts && opts.error === false) {\r\n        s.end()\r\n      } else {\r\n        s.emit('error', err)\r\n        s.destroy()\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  //the problem here, is that this is registering the first\r\n  //event listener.\r\n  //and so in this test, the close message is \r\n  //getting to the other side first\r\n md.pause = function () {}\r\n  md.resume = function () {}\r\n\r\n  function createStream(id, meta, opts) {\r\n    var s = es.through(function (data) {\r\n      if(!this.writable)\r\n        return outer.emit(\"error\", Error('stream is not writable: ' + id))\r\n      md.emit('data', [s.id, 'data', data])\r\n    }, function () {\r\n      md.emit('data', [s.id, 'end'])\r\n      if (this.readable && !opts.allowHalfOpen && !this.ended) {\r\n        this.emit(\"end\")\r\n      }\r\n    })\r\n    s.pause = function () {\r\n      md.emit('data', [s.id, 'pause'])\r\n    }\r\n    s.resume = function () {\r\n      md.emit('data', [s.id, 'resume'])\r\n    }\r\n    s.error = function (message) {\r\n      md.emit('data', [s.id, 'error', message])\r\n    }\r\n    s.once('close', function () {\r\n      md.emit('data', [s.id, 'close'])\r\n      delete streams[id]\r\n    })\r\n    s.writable = opts.writable\r\n    s.readable = opts.readable\r\n    streams[s.id = id] = s\r\n    s.meta = meta\r\n    return s\r\n  }\r\n\r\n  var outer = (\r\n    opts && opts.wrapper ? opts.wrapper(md) :\r\n    es.pipeline(es.split(), es.parse(), md, es.stringify())\r\n  )\r\n\r\n  if(md !== outer)\r\n    md.on('connection', function (stream) {\r\n      outer.emit('connection', stream)\r\n    })\r\n\r\n  var pipe = outer.pipe\r\n  outer.pipe = function (dest, opts) {\r\n    pipe.call(outer, dest, opts)\r\n    md.on('end', destroyAll)\r\n    md.on('close', destroyAll)\r\n    md.on('error', destroyAll)\r\n    return dest\r\n  }\r\n\r\n  outer.createStream = function (meta, opts) {\r\n    opts = opts || {}\r\n    if (!opts.writable && !opts.readable)\r\n      opts.readable = opts.writable = true\r\n    var s = createStream(createID(), meta, opts)\r\n    var _opts = {writable: opts.readable, readable: opts.writable}\r\n    md.emit('data', [s.id, 'new', {meta: meta, opts: _opts}])\r\n    return s\r\n  }\r\n  outer.createWriteStream = function (meta) {\r\n    return outer.createStream(meta, {writable: true, readable: false})\r\n  }\r\n  outer.createReadStream = function (meta) {\r\n    return outer.createStream(meta, {writable: false, readable: true})\r\n  }\r\n\r\n  return outer\r\n}\r\n\r\nmodule.exports = MuxDemux\r\n"},"sourceMaps":{"js":{"mappings":[{"source":"node_modules/mux-demux/index.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":2,"column":0},"generated":{"line":2,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":3,"column":0},"generated":{"line":3,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":4,"column":0},"generated":{"line":4,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":5,"column":0},"generated":{"line":5,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":6,"column":0},"generated":{"line":6,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":7,"column":0},"generated":{"line":7,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":8,"column":0},"generated":{"line":8,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":9,"column":0},"generated":{"line":9,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":10,"column":0},"generated":{"line":10,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":11,"column":0},"generated":{"line":11,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":12,"column":0},"generated":{"line":12,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":13,"column":0},"generated":{"line":13,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":14,"column":0},"generated":{"line":14,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":15,"column":0},"generated":{"line":15,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":16,"column":0},"generated":{"line":16,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":17,"column":0},"generated":{"line":17,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":18,"column":0},"generated":{"line":18,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":19,"column":0},"generated":{"line":19,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":20,"column":0},"generated":{"line":20,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":21,"column":0},"generated":{"line":21,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":22,"column":0},"generated":{"line":22,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":23,"column":0},"generated":{"line":23,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":24,"column":0},"generated":{"line":24,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":25,"column":0},"generated":{"line":25,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":26,"column":0},"generated":{"line":26,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":27,"column":0},"generated":{"line":27,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":28,"column":0},"generated":{"line":28,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":29,"column":0},"generated":{"line":29,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":30,"column":0},"generated":{"line":30,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":31,"column":0},"generated":{"line":31,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":32,"column":0},"generated":{"line":32,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":33,"column":0},"generated":{"line":33,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":34,"column":0},"generated":{"line":34,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":35,"column":0},"generated":{"line":35,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":36,"column":0},"generated":{"line":36,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":37,"column":0},"generated":{"line":37,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":38,"column":0},"generated":{"line":38,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":39,"column":0},"generated":{"line":39,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":40,"column":0},"generated":{"line":40,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":41,"column":0},"generated":{"line":41,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":42,"column":0},"generated":{"line":42,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":43,"column":0},"generated":{"line":43,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":44,"column":0},"generated":{"line":44,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":45,"column":0},"generated":{"line":45,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":46,"column":0},"generated":{"line":46,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":47,"column":0},"generated":{"line":47,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":48,"column":0},"generated":{"line":48,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":49,"column":0},"generated":{"line":49,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":50,"column":0},"generated":{"line":50,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":51,"column":0},"generated":{"line":51,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":52,"column":0},"generated":{"line":52,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":53,"column":0},"generated":{"line":53,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":54,"column":0},"generated":{"line":54,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":55,"column":0},"generated":{"line":55,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":56,"column":0},"generated":{"line":56,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":57,"column":0},"generated":{"line":57,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":58,"column":0},"generated":{"line":58,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":59,"column":0},"generated":{"line":59,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":60,"column":0},"generated":{"line":60,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":61,"column":0},"generated":{"line":61,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":62,"column":0},"generated":{"line":62,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":63,"column":0},"generated":{"line":63,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":64,"column":0},"generated":{"line":64,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":65,"column":0},"generated":{"line":65,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":66,"column":0},"generated":{"line":66,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":67,"column":0},"generated":{"line":67,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":68,"column":0},"generated":{"line":68,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":69,"column":0},"generated":{"line":69,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":70,"column":0},"generated":{"line":70,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":71,"column":0},"generated":{"line":71,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":72,"column":0},"generated":{"line":72,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":73,"column":0},"generated":{"line":73,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":74,"column":0},"generated":{"line":74,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":75,"column":0},"generated":{"line":75,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":76,"column":0},"generated":{"line":76,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":77,"column":0},"generated":{"line":77,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":78,"column":0},"generated":{"line":78,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":79,"column":0},"generated":{"line":79,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":80,"column":0},"generated":{"line":80,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":81,"column":0},"generated":{"line":81,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":82,"column":0},"generated":{"line":82,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":83,"column":0},"generated":{"line":83,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":84,"column":0},"generated":{"line":84,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":85,"column":0},"generated":{"line":85,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":86,"column":0},"generated":{"line":86,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":87,"column":0},"generated":{"line":87,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":88,"column":0},"generated":{"line":88,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":89,"column":0},"generated":{"line":89,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":90,"column":0},"generated":{"line":90,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":91,"column":0},"generated":{"line":91,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":92,"column":0},"generated":{"line":92,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":93,"column":0},"generated":{"line":93,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":94,"column":0},"generated":{"line":94,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":95,"column":0},"generated":{"line":95,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":96,"column":0},"generated":{"line":96,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":97,"column":0},"generated":{"line":97,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":98,"column":0},"generated":{"line":98,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":99,"column":0},"generated":{"line":99,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":100,"column":0},"generated":{"line":100,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":101,"column":0},"generated":{"line":101,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":102,"column":0},"generated":{"line":102,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":103,"column":0},"generated":{"line":103,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":104,"column":0},"generated":{"line":104,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":105,"column":0},"generated":{"line":105,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":106,"column":0},"generated":{"line":106,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":107,"column":0},"generated":{"line":107,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":108,"column":0},"generated":{"line":108,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":109,"column":0},"generated":{"line":109,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":110,"column":0},"generated":{"line":110,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":111,"column":0},"generated":{"line":111,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":112,"column":0},"generated":{"line":112,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":113,"column":0},"generated":{"line":113,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":114,"column":0},"generated":{"line":114,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":115,"column":0},"generated":{"line":115,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":116,"column":0},"generated":{"line":116,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":117,"column":0},"generated":{"line":117,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":118,"column":0},"generated":{"line":118,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":119,"column":0},"generated":{"line":119,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":120,"column":0},"generated":{"line":120,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":121,"column":0},"generated":{"line":121,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":122,"column":0},"generated":{"line":122,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":123,"column":0},"generated":{"line":123,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":124,"column":0},"generated":{"line":124,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":125,"column":0},"generated":{"line":125,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":126,"column":0},"generated":{"line":126,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":127,"column":0},"generated":{"line":127,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":128,"column":0},"generated":{"line":128,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":129,"column":0},"generated":{"line":129,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":130,"column":0},"generated":{"line":130,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":131,"column":0},"generated":{"line":131,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":132,"column":0},"generated":{"line":132,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":133,"column":0},"generated":{"line":133,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":134,"column":0},"generated":{"line":134,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":135,"column":0},"generated":{"line":135,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":136,"column":0},"generated":{"line":136,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":137,"column":0},"generated":{"line":137,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":138,"column":0},"generated":{"line":138,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":139,"column":0},"generated":{"line":139,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":140,"column":0},"generated":{"line":140,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":141,"column":0},"generated":{"line":141,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":142,"column":0},"generated":{"line":142,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":143,"column":0},"generated":{"line":143,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":144,"column":0},"generated":{"line":144,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":145,"column":0},"generated":{"line":145,"column":0}},{"source":"node_modules/mux-demux/index.js","original":{"line":146,"column":0},"generated":{"line":146,"column":0}}],"sources":{"node_modules/mux-demux/index.js":"var es = require('event-stream')\r\n  , extend = require('xtend')\r\n\r\nfunction MuxDemux (opts) {\r\n  if('function' === typeof opts)\r\n    opts = {wrapper: opts}\r\n\r\n  function createID() {\r\n    return (\r\n      Math.random().toString(16).slice(2) +\r\n      Math.random().toString(16).slice(2)\r\n    )\r\n  }\r\n\r\n  var streams = {}, streamCount = 0\r\n  var md = es.through(function (data) {\r\n    var id = data.shift()\r\n    var event = data[0]\r\n    var s = streams[id]\r\n    if(!s) {\r\n      if(event == 'close')\r\n        return\r\n      if(event != 'new') \r\n        return outer.emit('unknown', id)\r\n      md.emit('connection', createStream(id, data[1].meta, data[1].opts))\r\n    } \r\n    else if (event === 'pause')\r\n      s.paused = true\r\n    else if (event === 'resume') {\r\n      var p = s.paused\r\n      s.paused = false\r\n      if(p) s.emit('drain')\r\n    }\r\n    else if (event === 'error') {\r\n      var error = data[1]\r\n      if (typeof error === 'string') {\r\n        s.emit('error', new Error(error))\r\n      } else if (typeof error.message === 'string') {\r\n        var e = new Error(error.message)\r\n        extend(e, error)\r\n        s.emit('error', e)\r\n      } else {\r\n        s.emit('error', error)\r\n      }\r\n    }\r\n    else {\r\n      s.emit.apply(s, data)\r\n    }\r\n  })\r\n\r\n  function destroyAll (_err) {\r\n    md.removeListener('end', destroyAll)\r\n    md.removeListener('error', destroyAll)\r\n    md.removeListener('close', destroyAll)\r\n    var err = _err || new Error ('unexpected disconnection')\r\n    for (var i in streams) {\r\n      var s = streams[i]\r\n      s.destroyed = true\r\n      if (opts && opts.error === false) {\r\n        s.end()\r\n      } else {\r\n        s.emit('error', err)\r\n        s.destroy()\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  //the problem here, is that this is registering the first\r\n  //event listener.\r\n  //and so in this test, the close message is \r\n  //getting to the other side first\r\n md.pause = function () {}\r\n  md.resume = function () {}\r\n\r\n  function createStream(id, meta, opts) {\r\n    var s = es.through(function (data) {\r\n      if(!this.writable)\r\n        return outer.emit(\"error\", Error('stream is not writable: ' + id))\r\n      md.emit('data', [s.id, 'data', data])\r\n    }, function () {\r\n      md.emit('data', [s.id, 'end'])\r\n      if (this.readable && !opts.allowHalfOpen && !this.ended) {\r\n        this.emit(\"end\")\r\n      }\r\n    })\r\n    s.pause = function () {\r\n      md.emit('data', [s.id, 'pause'])\r\n    }\r\n    s.resume = function () {\r\n      md.emit('data', [s.id, 'resume'])\r\n    }\r\n    s.error = function (message) {\r\n      md.emit('data', [s.id, 'error', message])\r\n    }\r\n    s.once('close', function () {\r\n      md.emit('data', [s.id, 'close'])\r\n      delete streams[id]\r\n    })\r\n    s.writable = opts.writable\r\n    s.readable = opts.readable\r\n    streams[s.id = id] = s\r\n    s.meta = meta\r\n    return s\r\n  }\r\n\r\n  var outer = (\r\n    opts && opts.wrapper ? opts.wrapper(md) :\r\n    es.pipeline(es.split(), es.parse(), md, es.stringify())\r\n  )\r\n\r\n  if(md !== outer)\r\n    md.on('connection', function (stream) {\r\n      outer.emit('connection', stream)\r\n    })\r\n\r\n  var pipe = outer.pipe\r\n  outer.pipe = function (dest, opts) {\r\n    pipe.call(outer, dest, opts)\r\n    md.on('end', destroyAll)\r\n    md.on('close', destroyAll)\r\n    md.on('error', destroyAll)\r\n    return dest\r\n  }\r\n\r\n  outer.createStream = function (meta, opts) {\r\n    opts = opts || {}\r\n    if (!opts.writable && !opts.readable)\r\n      opts.readable = opts.writable = true\r\n    var s = createStream(createID(), meta, opts)\r\n    var _opts = {writable: opts.readable, readable: opts.writable}\r\n    md.emit('data', [s.id, 'new', {meta: meta, opts: _opts}])\r\n    return s\r\n  }\r\n  outer.createWriteStream = function (meta) {\r\n    return outer.createStream(meta, {writable: true, readable: false})\r\n  }\r\n  outer.createReadStream = function (meta) {\r\n    return outer.createStream(meta, {writable: false, readable: true})\r\n  }\r\n\r\n  return outer\r\n}\r\n\r\nmodule.exports = MuxDemux\r\n"},"lineCount":146}},"error":null,"hash":"df42025ca984f8dd12bef7071f80eec1","cacheData":{"env":{}}}